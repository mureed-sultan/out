"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1127],{1127:function(e,s,a){a.r(s);var l=a(85893),c=a(67294),r=a(25675),i=a.n(r),t=a(99811),d=a(45007),n=a(89387),o=a(41664),h=a.n(o),m=a(46869),x=a(93680),j=a(11676),g=a(11312);function u(){let[e,s]=(0,c.useState)([]),[a,r]=(0,c.useState)({totalOrder:0,totalSpend:0,walletAmount:0,email:"",createdAt:""}),n=(0,d.v9)(e=>e.auth),[o,u]=(0,c.useState)(null),[p,v]=(0,c.useState)(""),[N,f]=(0,c.useState)(null),[b,w]=(0,c.useState)(Boolean),[y,Z]=(0,c.useState)(""),[k,_]=(0,c.useState)(0),[S,C]=(0,c.useState)(""),[D,P]=(0,c.useState)(!1),[E,F]=(0,c.useState)([]);(0,c.useEffect)(()=>{(async()=>{try{let e=await t.Z.fetch('*[_type == "order" && username == "'.concat(n.name,'"]| order(_createdAt desc){...,costproduct}')),a=await t.Z.fetch('*[_type == "user" && username == "'.concat(n.name,'"][0]')),l=await t.Z.fetch('*[_type == "walletTransaction" && user == "'.concat(n.name,'"][0]{walletBalance}')),c=await t.Z.fetch('*[_type == "order" && username == "'.concat(n.name,'"]{costproduct}'));F(c);let i=e.reduce((e,s)=>{let a=parseFloat(s.costproduct);return isNaN(a)?e:e+a},0),d=await Promise.all(e.map(async e=>{let s=e.titleOfWork,a=await t.Z.fetch('*[_type == "product" && title == "'.concat(s,'"][0]')),l=await t.Z.fetch('*[_type == "provider" && name == "'.concat(e.provider,'"][0]')),c=null==a?void 0:a.images;return{...e,productImage:c,providerData:l||""}}));e.map(async e=>{}),s(d),r(a),f(l),v(i)}catch(e){console.error("Error fetching orders:",e)}})()},[n]);let O=async e=>{try{let s=await t.Z.fetch('*[_type == "provider" && name == "'.concat(e,'"][0]'));u(s)}catch(e){console.error("Error fetching provider details:",e)}},A=async()=>{try{if(!o){console.error("Error submitting feedback: Selected provider is null");return}let e=await t.Z.fetch('*[_type == "provider" && _id == "'.concat(o._id,'"][0]')),s={_key:Date.now().toString(),customerName:n.name,rating:k,comments:S,serviceName:y},a={...e,feedback:[...e.feedback||[],s]};await t.Z.patch(o._id).set({feedback:a.feedback}).commit(),alert("date enter"),P(!1)}catch(e){console.error("Error submitting feedback:",e)}};return(0,l.jsxs)("div",{className:"col-lg-9",children:[(0,l.jsx)("div",{className:"widget-title",children:(0,l.jsx)("h4",{children:"Dashboard"})}),(0,l.jsxs)("div",{className:"row",children:[(0,l.jsx)("div",{className:"col-md-6 col-lg-3",children:(0,l.jsxs)("div",{className:"dash-widget",children:[(0,l.jsx)("div",{className:"dash-img",children:(0,l.jsx)("span",{className:"dash-icon bg-yellow",children:(0,l.jsx)(i(),{width:100,height:100,src:"/assets/img/icons/dash-icon-01.svg",alt:"image"})})}),(0,l.jsx)("div",{className:"dash-info",children:(0,l.jsxs)("div",{className:"dash-order",children:[(0,l.jsx)("h6",{children:"Total Orders"}),(0,l.jsx)("h5",{children:E.length?E.length:0})]})})]})}),(0,l.jsx)("div",{className:"col-md-6 col-lg-3",children:(0,l.jsxs)("div",{className:"dash-widget",children:[(0,l.jsx)("div",{className:"dash-img",children:(0,l.jsx)("span",{className:"dash-icon bg-blue",children:(0,l.jsx)(i(),{width:100,height:100,src:"/assets/img/icons/wallet-icon-01.svg",alt:"image"})})}),(0,l.jsx)("div",{className:"dash-info",children:(0,l.jsxs)("div",{className:"dash-order",children:[(0,l.jsx)("h6",{children:"Total Spend"}),(0,l.jsxs)("h5",{children:["AED ",E?E.map(e=>parseFloat(e.costproduct)).reduce((e,s)=>e+s,0):0]})]})})]})}),(0,l.jsx)("div",{className:"col-md-6 col-lg-3",children:(0,l.jsxs)("div",{className:"dash-widget",children:[(0,l.jsx)("div",{className:"dash-img",children:(0,l.jsx)("span",{className:"dash-icon bg-blue",children:(0,l.jsx)(i(),{width:100,height:100,src:"/assets/img/icons/wallet-add.svg",alt:"image"})})}),(0,l.jsx)("div",{className:"dash-info",children:(0,l.jsxs)("div",{className:"dash-order",children:[(0,l.jsx)("h6",{children:"Wallet"}),(0,l.jsxs)("h5",{children:["AED ",N?N.walletBalance:0]})]})})]})}),(0,l.jsx)("div",{className:"col-md-6 col-lg-3",children:(0,l.jsxs)("div",{className:"dash-widget",children:[(0,l.jsx)("div",{className:"dash-img",children:(0,l.jsx)("span",{className:"dash-icon bg-light-danger",children:(0,l.jsx)(i(),{width:100,height:100,src:"/assets/img/icons/wallet-amt.svg",alt:"image"})})}),(0,l.jsx)("div",{className:"dash-info",children:(0,l.jsxs)("div",{className:"dash-order",children:[(0,l.jsx)("h6",{children:"Total Savings"}),(0,l.jsx)("h5",{children:"AED 0"})]})})]})})]}),(0,l.jsxs)("div",{className:"row",children:[(0,l.jsxs)("div",{className:"col-lg-8 d-flex flex-column",children:[(0,l.jsx)("h6",{className:"user-title",children:"Recent Booking"}),(0,l.jsx)("div",{className:"table-responsive recent-booking flex-fill",children:(0,l.jsx)("table",{className:"table mb-0",children:(0,l.jsxs)("tbody",{children:[(0,l.jsx)("tr",{children:(0,l.jsx)("th",{children:(0,l.jsx)(h(),{className:"btn btn-primary",href:"/",children:"Order New Service"})})}),e.length>0?e.map((e,s)=>(0,l.jsx)("tr",{children:(0,l.jsxs)("td",{className:"d-flex justify-content-between",children:[(0,l.jsxs)("h2",{className:"table-avatar",children:[(0,l.jsx)("a",{href:"#",className:"avatar avatar-m me-2",children:(0,l.jsx)(i(),{width:1024,height:100,className:"img-fluid",alt:"Demo text",src:"https://cdn.sanity.io/images/z5hb38ic/production/".concat(e.productImage.asset._ref.replace("image-","").replace(/-([^/-]*)$/,".$1"))})}),(0,l.jsxs)("span",{children:[(0,l.jsxs)("h6",{children:[e.titleOfWork," "]}),(0,l.jsx)("br",{}),e.location," ",(0,l.jsx)("br",{}),e.status?e.status:"Pending",(0,l.jsx)("br",{}),"Order Price:",e.origionalPrice?e.origionalPrice:"Pending",(0,l.jsx)("br",{}),"You Paid: ",e.costproduct?e.costproduct:"Pending",(0,l.jsxs)("p",{className:"d-flex gap-2",children:["Any Payment to Provider : ",e.providerData?e.providerData.paymentcollected.map(s=>s.serviceName===e.titleOfWork?(0,l.jsx)("p",{children:s.price},s._id):null):"0.00","      "]}),(0,l.jsxs)("p",{className:"d-flex gap-2",children:["Additional Material: ",e.providerData?e.providerData.paymentcollected.map(s=>s.serviceName===e.titleOfWork?(0,l.jsx)("p",{children:s.material},s._id):null):"0.00"]}),(0,l.jsxs)("span",{children:[(0,l.jsx)("i",{className:"feather-calendar"}),e.workingDate]})]})]}),(0,l.jsxs)("div",{className:"d-flex flex-column",children:[(0,l.jsxs)("a",{href:"#",onClick:()=>{O(e.provider),w(!0)},children:["Provider ",(0,l.jsx)("br",{}),e.provider]}),"complete"==e.status?(0,l.jsx)("a",{href:"#",onClick:()=>{P(!0),O(e.provider),Z(e.titleOfWork)},children:"Comments / Suggeston "}):(0,l.jsx)(l.Fragment,{})]})]})},s)):(0,l.jsx)(l.Fragment,{})]})})})]}),(0,l.jsxs)(m.Z,{show:null!==o&&b,onHide:()=>{u(null),w(!1)},children:[(0,l.jsx)(m.Z.Header,{closeButton:!0,children:(0,l.jsx)(m.Z.Title,{children:o&&o.name})}),(0,l.jsx)(m.Z.Body,{children:(0,l.jsx)("div",{className:"text-center",children:(0,l.jsxs)("div",{className:"d-flex mb-3 align-items-center",children:[o&&o.image?(0,l.jsx)(i(),{width:150,height:100,className:"img-fluid rounded-circle",alt:"Demo text",src:"https://cdn.sanity.io/images/z5hb38ic/production/".concat(o.image.asset._ref.replace("image-","").replace(/-([^/-]*)$/,".$1"))}):(0,l.jsx)(l.Fragment,{children:"No Image Found"}),(0,l.jsxs)("div",{className:"mb-10",children:[(0,l.jsxs)("p",{className:"ml-3 text-center",children:[(0,l.jsx)("span",{className:"fw-bold",children:"Email:"})," ",o&&o.email]}),(0,l.jsxs)("p",{className:"ml-3 mt-1 text-center",children:[(0,l.jsx)("span",{className:"fw-bold",children:" Phone Number:"})," ",o&&o.phone]})]})]})})}),(0,l.jsx)(m.Z.Footer,{children:(0,l.jsx)(x.Z,{variant:"secondary",onClick:()=>{u(null),w(!1)},children:"Close"})})]}),(0,l.jsxs)(m.Z,{show:D,onHide:()=>P(!1),children:[(0,l.jsx)(m.Z.Header,{closeButton:!0,children:(0,l.jsx)(m.Z.Title,{children:"Provide Feedback"})}),(0,l.jsxs)(m.Z.Body,{children:[(0,l.jsx)(j.Z.Label,{children:y}),(0,l.jsxs)(j.Z.Group,{controlId:"rating",children:[(0,l.jsx)(j.Z.Label,{children:"Rating"}),(0,l.jsx)(g.Z,{count:5,size:24,value:k,onChange:e=>_(e),activeColor:"#ffd700"})]}),(0,l.jsxs)(j.Z.Group,{controlId:"comment",children:[(0,l.jsx)(j.Z.Label,{children:"Comment"}),(0,l.jsx)(j.Z.Control,{as:"textarea",rows:3,value:S,onChange:e=>C(e.target.value)})]})]}),(0,l.jsxs)(m.Z.Footer,{children:[(0,l.jsx)(x.Z,{variant:"secondary",onClick:()=>P(!1),children:"Close"}),(0,l.jsx)(x.Z,{variant:"primary",onClick:A,children:"Submit Feedback"})]})]})]})]})}s.default=()=>(0,l.jsx)(d.zt,{store:n.Z,children:(0,l.jsx)(u,{})})}}]);