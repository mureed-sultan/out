(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[791],{65990:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/provider/pages/dashboard",function(){return s(63003)}])},63003:function(e,a,s){"use strict";s.r(a);var t=s(85893),r=s(67294),i=s(25675),n=s.n(i),o=s(99811),l=s(46869),c=s(11676),d=s(93680),m=s(90859),h=s(45007),p=s(89387);function u(){let[e,a]=(0,r.useState)([]),[s,i]=(0,r.useState)(!1),[p,u]=(0,r.useState)(""),[x,j]=(0,r.useState)(null),[v,g]=(0,r.useState)({}),[N,f]=(0,r.useState)([]),[y,k]=(0,r.useState)(""),[b,_]=(0,r.useState)(""),w=(0,h.v9)(e=>e.provider),Z=async()=>{try{let e=await o.Z.fetch('*[_type == "order" && provider == "'.concat(w.name,'"] | order(_createdAt desc)')),s=await o.Z.fetch('*[_type == "provider" && name == "'.concat(w.name,'"]{paymentcollected}[0]')),t=await Promise.all(e.map(async e=>{let a=await o.Z.fetch('*[_type == "product" && title == "'.concat(e.titleOfWork,'"][0]{"images":images.asset->url}')),s=await o.Z.fetch('*[_type == "provider" && name == "'.concat(e.provider,'"][0]')),t=a.images;return{...e,images:t,providerData:s||""}}));a(t),g(s)}catch(e){console.error("Error fetching orders:",e)}};(0,r.useEffect)(()=>{Z()},[]);let D=async()=>{try{if(!x){console.error("No selected order to process payment.");return}try{let e=x._id;await o.Z.patch(e).set({status:"complete"}).commit(),console.log("Order marked as complete successfully."),Z()}catch(e){console.error("Error marking order as complete:",e)}if(!p||isNaN(parseFloat(p))){console.error("Invalid payment amount.");return}let e={_key:new Date().toISOString(),customerName:x.username,price:parseFloat(p),serviceName:x.titleOfWork,bookingData:x.workingDate,instruction:y,material:b,imageUrls:[]};for(let a of N){let s=await o.Z.assets.upload("image",a);e.imageUrls.push(s.url)}let a='*[_type == "provider" && name=="'.concat(w.name,'" ][0]'),s=await o.Z.fetch(a);if(!s||!s._id){console.error("Provider document not found or does not have an ID.");return}let t=[...s.paymentcollected||[],e];await o.Z.patch(s._id).set({paymentcollected:t}).commit(),i(!1),alert("Payment received"),Z()}catch(e){console.error("Error processing payment:",e)}},C=e=>{j(e),i(!0)};return(0,t.jsx)(m.default,{children:(0,t.jsxs)("div",{className:"page-wrapper",children:[(0,t.jsxs)("div",{className:"content container-fluid",children:[(0,t.jsx)("div",{className:"page-header",children:(0,t.jsx)("div",{className:"row",children:(0,t.jsx)("div",{className:"col-md-4",children:(0,t.jsx)("div",{className:"provider-subtitle",children:(0,t.jsx)("h6",{children:"Provider Dashboard"})})})})}),(0,t.jsx)("div",{className:"row",children:(0,t.jsxs)("div",{className:"col-md-12",children:[(0,t.jsx)("h6",{className:"subhead-title",children:"Recent Booking"}),e?e.map((e,a)=>(0,t.jsxs)("div",{className:"booking-list",children:[(0,t.jsxs)("div",{className:"booking-widget",children:[(0,t.jsxs)("div",{className:"booking-img",children:[(0,t.jsx)("a",{href:"service-details.html",children:(0,t.jsx)(n(),{width:1280,height:100,src:e.images?e.images:"/assets/img/services/service-18.jpg",alt:"User Image"})}),(0,t.jsx)("div",{className:"fav-item",children:(0,t.jsx)("a",{href:"javascript:void(0)",className:"fav-icon",children:(0,t.jsx)("i",{className:"feather-heart"})})})]}),(0,t.jsxs)("div",{className:"booking-det-info",children:[(0,t.jsxs)("h3",{children:[(0,t.jsx)("a",{children:e.titleOfWork?e.titleOfWork:"Not Found"}),(0,t.jsx)("span",{className:"badge badge-success",children:e.status?e.status:"Pending"})]}),(0,t.jsxs)("ul",{className:"booking-details",children:[(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"book-item",children:"Booking Date"})," : ",e.workingDate?e.workingDate:"Data not found",", ",e.hoursNeeded?e.hoursNeeded:"Hour not specified"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"book-item",children:"Booking Number"})," : ",e._updatedAt?e._updatedAt:"Data not found"]})," ",(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"book-item",children:"Location"})," : ",e.location?e.location:"Data not found"]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"book-item",children:"Amount"})," : ",e.costproduct?e.costproduct:"Price not defined"," ",(0,t.jsx)("span",{className:"badge-grey"})]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"book-item",children:"Cash Received "})," :     ",e.providerData?e.providerData.paymentcollected.map(a=>a.serviceName===e.titleOfWork?(0,t.jsx)("span",{children:a.price},a._id):null):"0.00",(0,t.jsx)("span",{className:"badge-grey"})]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"book-item",children:"Extra Matterial Amount"})," :",e.providerData?e.providerData.paymentcollected.map(a=>a.serviceName===e.titleOfWork?(0,t.jsx)("span",{children:a.material},a._id):null):"0.00",(0,t.jsx)("span",{className:"badge-grey"})]}),(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{className:"book-item",children:"Customer"})," :",(0,t.jsx)("div",{className:"user-book",children:e.username?e.username:"Not found"}),(0,t.jsxs)("p",{children:[(0,t.jsx)("a",{className:"__cf_email__"}),e.email]}),(0,t.jsx)("p",{children:e.phone?e.phone:0})]})]})]})]}),(0,t.jsx)("div",{className:"booking-action",children:v&&v.paymentcollected&&!v.paymentcollected.some(a=>a.serviceName===e.titleOfWork&&a.bookingData===e.workingDate||a.customerName===e.username&&a.price===parseFloat(e.costproduct||"0"))?(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>C(e),children:"Accept Payment"}):(0,t.jsx)(t.Fragment,{})})]},a)):(0,t.jsx)(t.Fragment,{}),(0,t.jsx)("div",{className:"view-history",children:(0,t.jsx)("a",{href:"#",className:"btn btn-primary",onClick:Z,children:"View All Orders"})})]})})]}),(0,t.jsxs)(l.Z,{show:s,onHide:()=>i(!1),children:[(0,t.jsx)(l.Z.Header,{closeButton:!0,children:(0,t.jsx)(l.Z.Title,{children:"Accept Payment"})}),(0,t.jsxs)(l.Z.Body,{children:[(0,t.jsxs)(c.Z.Group,{controlId:"paymentAmount",children:[(0,t.jsx)(c.Z.Label,{children:"Enter Amount"}),(0,t.jsx)(c.Z.Control,{type:"text",placeholder:"Enter amount",value:p,onChange:e=>u(e.target.value)}),(0,t.jsx)(c.Z.Control,{type:"text",placeholder:"What i do in this work",value:y,onChange:e=>k(e.target.value)}),(0,t.jsx)(c.Z.Control,{type:"text",placeholder:"Any material Amount",value:b,onChange:e=>_(e.target.value)}),(0,t.jsx)(c.Z.Control,{type:"file",multiple:!0,onChange:e=>{let a=e.target.files;a&&f(Array.from(a))}})]}),x&&(0,t.jsx)("div",{children:(0,t.jsxs)("p",{children:["Order placed by: ",x.username]})})]}),(0,t.jsxs)(l.Z.Footer,{children:[(0,t.jsx)(d.Z,{variant:"secondary",onClick:()=>i(!1),children:"Close"}),(0,t.jsx)(d.Z,{variant:"primary",onClick:D,children:"Submit"})]})]})]})})}a.default=()=>(0,t.jsx)(h.zt,{store:p.Z,children:(0,t.jsx)(u,{})})}},function(e){e.O(0,[8764,5675,9668,4440,1664,433,4620,1368,2010,8738,859,2888,9774,179],function(){return e(e.s=65990)}),_N_E=e.O()}]);